# 1筆書きマスパズル

Canvas上で遊べる「1筆書きマスパズル」です。  
盤面サイズ・お邪魔マス数を自由に変更して問題を生成し、スタート（S）からゴール（G）まで**通行可能マスをすべて1回ずつ**通るルートを描きます。

🎮 **[オンラインで遊ぶ](https://king-gnu.github.io/pazzle-game/)**

## 📖 ルール

- 上下左右に隣接するマスへ移動（斜め移動は不可）
- 同じマスを2回通ることはできません
- ☒（お邪魔マス）には入れません
- スタート（S）から開始し、ゴール（G）で終了
- **すべての白いマスを1回ずつ通過**するとクリア

## 🎮 操作方法

### 基本操作
| 操作 | PC | スマホ |
|------|-----|--------|
| 線を引く | マウスドラッグ | 指でなぞる |
| 一時停止 | クリックを離す | 指を離す |
| 続きを引く | 終点から再ドラッグ | 終点から再タッチ |
| 1手戻し | 直前のマスに戻る | 直前のマスに戻る |
| 任意地点から再開 | ルート上のマスをクリック | ルート上のマスをタッチ |

### ボタン
- **📖 ルール**: ゲームのルールを表示
- **次の問題**: お邪魔マス数をランダムに変更して新問題を生成
- **この設定で生成**: 現在のお邪魔マス数を維持して新問題を生成
- **リセット**: 描いた線をクリア
- **クリアルート表示**: 正解ルートをモーダルで表示
- **📋 問題コードをコピー**: 現在の問題を共有用コードとしてコピー
- **📥 問題コードを入力**: 共有された問題コードを読み込む

## ⚙️ 設定項目

| 項目 | 説明 | 範囲 |
|------|------|------|
| 盤面サイズ | グリッドのサイズ | 6×6 ～ 10×10 |
| お邪魔マス数 | 通行不可マスの数 | サイズに応じた最小～最大 |

## 📊 難易度

難易度は1.0～5.0のスケールで表示されます。以下の要素で計算されます：
- 盤面サイズ
- お邪魔マス数
- ルートの曲がり角の多さ
- 分岐の複雑さ
- お邪魔マスの配置パターン

## 🔗 問題共有

生成された問題は「問題コード」として共有できます。
1. 「📋 問題コードをコピー」で現在の問題をコピー
2. 友達にコードを送信
3. 「📥 問題コードを入力」でコードを貼り付けて読み込み

## 💻 ローカルで遊ぶ

このプロジェクトは静的ファイルのみで動作します。

### 方法1: 直接開く
`index.html` をブラウザで直接開く

### 方法2: ローカルサーバ（推奨）
```bash
# Python 3
python -m http.server 8000

# Node.js (npx)
npx serve
```
その後 `http://localhost:8000/` を開きます。

## 🚀 GitHub Pages へのデプロイ

このリポジトリにはGitHub Actionsによる自動デプロイ設定が含まれています。

1. GitHubにpush
2. **Settings → Pages** を開く
3. **Build and deployment** を **GitHub Actions** に設定
4. `main`ブランチへのpushで自動公開

公開URL: `https://<ユーザー名>.github.io/<リポジトリ名>/`

## 📁 ファイル構成

```
js_1line/
├── index.html          # メインHTML
├── style.css           # スタイルシート（レスポンシブ対応）
├── main.js             # ゲームロジック・パズル生成
├── README.md           # このファイル
├── 仕様書.md           # 詳細仕様書
├── .github/
│   └── workflows/
│       └── deploy.yml  # GitHub Actions設定
├── .gitignore
└── .nojekyll           # GitHub Pages用
```

## 🔧 開発者向け情報

### ストレステスト
URLパラメータで生成品質のテストができます：
```
?stress=1              # デフォルト設定でテスト
?stress=1&runs=1000    # 1000回テスト
?stress=1&sizes=6,7,8  # 特定サイズのみ
```
結果は `console` および `window.__stressSummaries` で確認できます。

### 主要な関数
- `generatePuzzle()`: パズル生成のエントリポイント
- `generateRandomPathPuzzle()`: ランダムパス生成
- `isBoardAcceptable()`: 盤面の制約チェック
- `calculateDifficulty()`: 難易度計算
- `encodePuzzleData()` / `decodePuzzleData()`: 問題コードの変換

## 📝 変更履歴

- 2026/01/09: ルールボタン・モーダル追加
- 2026/01/09: お邪魔マスを中央寄りに配置するよう改善
- 2026/01/08: iPhone対応の問題共有モーダル追加
- 2026/01/08: 「この設定で生成」ボタン追加
- 2026/01/08: 難易度表示機能追加
- 2026/01/08: 問題共有機能追加
- 2026/01/08: スマホ対応（レスポンシブデザイン）
- 2026/01/08: 初版公開
