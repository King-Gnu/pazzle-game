# 1 筆書きマスパズル - 正式仕様書

## 1. 基本ルール

### 1.1 盤面

- n×n の正方形グリッド
- 各マスは以下のいずれか：
  - **通行可能マス**（白）
  - **☒ マス**（グレー、通行不可）

### 1.2 目的

通行可能なすべてのマスを**1 回ずつ**、**途切れずに**、**1 本の線でなぞる**（1 筆書き）

### 1.3 移動ルール

- 移動方向：**上下左右のみ**（斜め移動禁止）
- **同じマスを 2 回以上通ってはいけない**
- **線の分岐・交差は禁止**

### 1.4 スタートとゴール

- **スタート地点**と**ゴール地点**は事前に指定
- スタート ≠ ゴール（異なるマス）
- 必ず外周（盤面の端）に配置

### 1.5 禁止事項

- ☒ マスを通ること
- 通行可能マスを 1 つでも残すこと
- 途中で線が止まること
- 分岐・袋小路を作ること

## 2. クリア条件

以下をすべて満たしたときクリア：

1. ✅ 全通行可能マスを 1 回ずつ通過
2. ✅ スタートマスから開始
3. ✅ ゴールマスで終了
4. ✅ スタートからゴールまで 1 本の連続した線
5. ✅ ルール違反なし（☒ マス通過なし、分岐なし、交差なし）

## 3. 問題の成立条件（グラフ理論による検証）

### 3.1 オイラーパスの条件

1 筆書き問題は**オイラーパス**として定義される。オイラーパスが存在する条件：

- **すべての通行可能マスが連結している**（1 つの連結成分）
- **次数の条件**：
  - スタートとゴールの**次数が奇数**
  - その他すべてのマスの**次数が偶数**

※次数 = そのマスに隣接する通行可能マスの数

### 3.2 市松模様（チェス盤）による検証

盤面を白黒で市松模様に塗ったとき：

- 通行可能マスの総数が**奇数**の場合：
  - スタートとゴールは**同じ色**
- 通行可能マスの総数が**偶数**の場合：
  - スタートとゴールは**異なる色**

### 3.3 成立しない盤面の例

以下の場合、1 筆書きは不可能：

- ❌ 通行可能マスが複数の孤立した領域に分かれている
- ❌ スタートまたはゴールが次数 0（周囲が全て ☒ マス）
- ❌ 次数が奇数のマスが 3 つ以上存在
- ❌ 市松模様条件に違反

## 4. クリア可能な盤面設計指針

### 4.1 基本方針

1. **まず通行可能マスで 1 筆書き経路を決める**
2. **その後、☒ マスを配置する**（経路を妨げない位置に）

### 4.2 簡単な盤面パターン例

#### パターン A: 3×3 （☒ マスなし）

```
S - -
| | |
- - G
```

- スタート: [0, 0]
- ゴール: [2, 2]
- 通行可能マス: 9 個（奇数） → スタート・ゴールは同じ色 ✓

#### パターン B: 5×5 （☒ マス 2 個）

```
S - - - -
|       |
- ☒ - ☒ -
|       |
- - - - G
```

- スタート: [0, 0]
- ゴール: [4, 4]
- 通行可能マス: 25 - 2 = 23 個（奇数） → 同じ色 ✓
- ☒ マス位置: [2, 1], [2, 3]（経路を遮断しない）

#### パターン C: 4×4 （☒ マスなし）

```
S - - -
|     |
|     |
- - - G
```

- スタート: [0, 0]
- ゴール: [3, 3]
- 通行可能マス: 16 個（偶数） → スタート・ゴールは異なる色 ✓

### 4.3 推奨実装パターン

現在の実装には以下を採用：

- **5×5 盤面**
- **☒ マス 2 個** [2, 1], [2, 3]
- **スタート**: [0, 0]（左上）
- **ゴール**: [4, 4]（右下）
- **通行可能マス**: 23 個（奇数）

解答例の 1 つ：

```
0→1  2  3  4
↓        ↓
5  X  6  X  7
↓     ↓     ↓
8  9←10 11←12
↓           ↓
13→14→15→16 17
            ↓
18→19→20→21→22
```

## 5. 実装での注意点

### 5.1 クリア判定ロジック

```javascript
// 1. 全通行マス数をカウント
// 2. path.length === 全通行マス数
// 3. path[0] === startPos
// 4. path[最後] === goalPos
// 5. 隣接チェック（上下左右のみ）
// 6. ☒マス通過なし
```

### 5.2 盤面検証

新しい盤面を作成する際は：

1. ✅ 通行可能マスが連結しているか
2. ✅ スタート・ゴールの次数が奇数か
3. ✅ 他のマスの次数が偶数か
4. ✅ 市松模様条件を満たすか

## 6. 今後の拡張

### 6.1 難易度調整

- **Easy**: ☒ マスなし、小さい盤面（3×3, 4×4）
- **Normal**: ☒ マス数個、中盤面（5×5, 6×6）
- **Hard**: ☒ マス多数、大盤面（7×7 以上）

### 6.2 追加機能

- 盤面エディタ（自作問題作成）
- ヒント機能（次の 1 手を表示）
- 複数問題のステージ制
- タイムアタックモード

---

## 変更履歴

- 2026/01/08: 初版作成、クリア可能な盤面に修正
